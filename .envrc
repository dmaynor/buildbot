# Create and activate Python virtual environment if it doesn't exist
if [ ! -d ".venv" ]; then
    echo "Creating Python virtual environment..."
    python3 -m venv .venv
fi

# Activate virtual environment
source .venv/bin/activate

# Install requirements if they exist and haven't been installed
if [ -f "requirements.txt" ]; then
    if [ ! -f ".venv/pip-installed" ]; then
        echo "Installing Python dependencies..."
        pip install -r requirements.txt
        touch .venv/pip-installed
    fi
fi

# Set environment variables
export PYTHONPATH=$PWD:$PYTHONPATH
export MODEL_DIR="./models"
export PROMPT_DIR="./prompts"

# Create necessary directories
mkdir -p $MODEL_DIR
mkdir -p $PROMPT_DIR
mkdir -p .buildbot

# BuildBot environment configuration
export BUILDBOT_MODEL_DIR="$PWD/models"
export BUILDBOT_PROMPT_DIR="$PWD/prompts"
export BUILDBOT_CONFIG_DIR="$PWD/.buildbot"
export BUILDBOT_MODEL_URL="https://huggingface.co/TheBloke/TinyLlama-1.1B-Chat-GGUF/resolve/main/tinyllama-1.1b-chat.Q4_K_M.gguf"

# Create required directories
mkdir -p "$BUILDBOT_MODEL_DIR" "$BUILDBOT_PROMPT_DIR" "$BUILDBOT_CONFIG_DIR"

echo "BuildBot development environment activated!" 